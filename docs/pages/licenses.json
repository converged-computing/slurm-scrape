{
    "url": "https://slurm.schedmd.com/licenses.html",
    "sections": [
        {
            "title": "\n\nSlurm Workload Manager\n\n",
            "content": "\n\nSchedMD\n\n"
        },
        {
            "title": "Licenses Guide",
            "content": "Licenses Overview\n\nSlurm can help with software license management by assigning available\nlicenses to jobs at scheduling time. If the licenses are not available, jobs\nare kept pending until licenses become available.  Licenses in Slurm are\nessentially shared resources, meaning configured resources that are not tied to\na specific host but are associated with the entire cluster.Licenses in Slurm can be configured in two ways:\nLocal Licenses:\nLocal licenses are local to the cluster using the\nslurm.conf in which they are configured.\n\nRemote Licenses:\nRemote licenses are served by the database and are configured using the\nsacctmgr command. Remote licenses are dynamic in nature as upon running\nthe sacctmgr command, the slurmdbd updates all clusters the\nlicenses are assigned to.\n\nLocal Licenses\n\nLocal licenses are defined in the slurm.conf using the Licenses\noption.slurm.conf:\nLicenses=fluent:30,ansys:100\nConfigured licenses can be viewed using the scontrol command.\n$ scontrol show lic\nLicenseName=ansys\n    Total=100 Used=0 Free=100 Remote=no\nLicenseName=fluent\n    Total=30 Used=0 Free=30 Remote=no\nRequesting licenses is done by using the -L, or --licenses, submission\noption.\n$ sbatch -L ansys:2 script.sh\nSubmitted batch job 5212\n\n$ scontrol show lic\nLicenseName=ansys\n    Total=100 Used=2 Free=98 Remote=no\nLicenseName=fluent\n    Total=30 Used=0 Free=30 Remote=no\nLicenses may also be requested using the --tres-per-task option for\njob submission. If this approach is used, the license must also be defined in\nthe AccountingStorageTRES option of the slurm.conf.slurm.conf:\nLicenses=fluent:30\nAccountingStorageTRES=license/fluent\nRequesting licenses with the --tres-per-task submission option.\n$ sbatch --tres-per-task=license/fluent:4 script.sh\nSubmitted batch job 6482\n\n$ scontrol show lic\nLicenseName=fluent\n    Total=30 Used=4 Free=26 Reserved=0 Remote=no\nRemote Licenses\n\nUse CaseA site has two license servers, one serves 100 Nastran licenses provided by\nFlexNet and the other serves 50 Matlab licenses from Reprise License\nManagement. The site has two clusters named \"fluid\" and \"pdf\" dedicated to run\nsimulation jobs using both products. The managers want to split the number of\nNastran licenses equally between clusters, but assign 70% of the Matlab\nlicenses to cluster \"pdf\" and the remaining 30% to cluster \"fluid\".Configuring Slurm for the use case\n\nHere we assume that both clusters have been configured correctly in the\nslurmdbd using the sacctmgr command.\n$ sacctmgr show clusters format=cluster,controlhost\n   Cluster     ControlHost\n---------- ---------------\n     fluid     143.11.1.3\n       pdf     144.12.3.2\nThe licenses are added using the sacctmgr command, specifying the\ntotal count of licenses and the percentage that should be allocated\nto each cluster. This can be done either in one step or through a\nmulti-step process.One step:\n$ sacctmgr add resource name=nastran cluster=fluid,pdf \\\n  count=100 allowed=50 server=flex_host servertype=flexlm type=license\n Adding Resource(s)\n  nastran@flex_host\n   Cluster - fluid\t50\n   Cluster - pdf\t50\n Settings\n  Name           = nastran\n  Server         = flex_host\n  Description    = nastran\n  ServerType     = flexlm\n  Count          = 100\n  Type           = License\nMulti-step:\n$ sacctmgr add resource name=matlab count=50 server=rlm_host \\\n  servertype=rlm type=license\n Adding Resource(s)\n  matlab@rlm_host\n Settings\n  Name           = matlab\n  Server         = rlm_host\n  Description    = matlab\n  ServerType     = rlm\n  Count          = 50\n  Type           = License\n\n$ sacctmgr add resource name=matlab server=rlm_host \\\n  cluster=pdf allowed=70\n Adding Resource(s)\n  matlab@rlm_host\n   Cluster - pdf\t70\n Settings\n  Name           = matlab\n  Server         = rlm_host\n  Count          = 50\n  LastConsumed   = 0\n  Flags          = (null)\n  Type           = License\n\n$ sacctmgr add resource name=matlab server=rlm_host \\\n  cluster=fluid allowed=30\n Adding Resource(s)\n  matlab@rlm_host\n   Cluster - fluid\t30\n Settings\n  Name           = matlab\n  Server         = rlm_host\n  Count          = 50\n  LastConsumed   = 0\n  Flags          = (null)\n  Type           = License\nThe sacctmgr command will now display the grand total\nof licenses.\n$ sacctmgr show resource\n      Name     Server     Type  Count LastConsumed Allocated ServerType                Flags\n---------- ---------- -------- ------ ------------ --------- ---------- --------------------\n   nastran  flex_host  License    100            0       100     flexlm\n    matlab   rlm_host  License     50            0       100        rlm\n$ sacctmgr show resource withclusters\n      Name     Server     Type  Count LastConsumed Allocated ServerType    Cluster  Allowed                Flags\n---------- ---------- -------- ------ ------------ --------- ---------- ---------- -------- --------------------\n   nastran  flex_host  License    100            0       100     flexlm      fluid       50\n   nastran  flex_host  License    100            0       100     flexlm        pdf       50 \n    matlab   rlm_host  License     50            0       100        rlm      fluid       30\n    matlab   rlm_host  License     50            0       100        rlm        pdf       70\nThe configured licenses are now visible on both clusters using the\nscontrol command.\n# On cluster \"pdf\":\n$ scontrol show lic\nLicenseName=matlab@rlm_host\n    Total=35 Used=0 Free=35 Reserved=0 Remote=yes\n    LastConsumed=0 LastDeficit=0 LastUpdate=2023-02-28T17:01:44\nLicenseName=nastran@flex_host\n    Total=50 Used=0 Free=50 Reserved=0 Remote=yes\n    LastConsumed=0 LastDeficit=0 LastUpdate=2023-02-28T17:01:44\n\n# On cluster \"fluid\":\n$ scontrol show lic\nLicenseName=matlab@rlm_host\n    Total=15 Used=0 Free=15 Reserved=0 Remote=yes\n    LastConsumed=0 LastDeficit=0 LastUpdate=2023-02-28T17:01:44\nLicenseName=nastran@flex_host\n    Total=50 Used=0 Free=50 Reserved=0 Remote=yes\n    LastConsumed=0 LastDeficit=0 LastUpdate=2023-02-28T17:01:44\nWhen submitting jobs to remote licenses, the name and server must be\nused.\n$ sbatch -L nastran@flex_host script.sh\nSubmitted batch job 5172\nLicense percentages and counts can be modified as shown below:\n$ sacctmgr modify resource name=matlab server=rlm_host set \\\n  count=200\n Modified server resource ...\n  matlab@rlm_host\n  Cluster - fluid\t- matlab@rlm_host\n  Cluster - pdf\t- matlab@rlm_host\n\n$ sacctmgr modify resource name=matlab server=rlm_host \\\n  cluster=pdf set allowed=60\n Modified server resource ...\n  Cluster - pdf\t- matlab@rlm_host\n\n$ sacctmgr show resource withclusters\n      Name     Server     Type  Count LastConsumed Allocated ServerType    Cluster  Allowed                Flags\n---------- ---------- -------- ------ ------------ --------- ---------- ---------- -------- --------------------\n   nastran  flex_host  License    100            0       100     flexlm      fluid       50\n   nastran  flex_host  License    100            0       100     flexlm        pdf       50\n    matlab   rlm_host  License    200            0        90        rlm      fluid       30\n    matlab   rlm_host  License    200            0        90        rlm        pdf       60\nLicenses can be deleted either on the cluster or all together as shown:\n$ sacctmgr delete resource where name=matlab server=rlm_host cluster=fluid\n Deleting resource(s)...\n Deleting resource(s)...\n  Cluster - fluid\t- matlab@rlm_host\n\n$ sacctmgr delete resource where name=nastran server=flex_host\n Deleting resource(s)...\n  nastran@flex_host\n  Cluster - fluid\t- nastran@flex_host\n  Cluster - pdf\t- nastran@flex_host\n\n$ sacctmgr show resource withclusters\n      Name     Server     Type  Count LastConsumed Allocated ServerType    Cluster  Allowed                Flags\n---------- ---------- -------- ------ ------------ --------- ---------- ---------- -------- --------------------\n    matlab   rlm_host  License    200            0        60        rlm        pdf       60\nStarting with Slurm 23.02, a new Absolute flag is available that\nindicates the license allowed values for each cluster are to be treated as\nabsolute license counts rather than percentages.Some brief examples of license management using this flag.\n$ sacctmgr -i add resource name=deluxe cluster=fluid,pdf count=150 allowed=70 \\\n  server=flex_host servertype=flexlm flags=absolute\n Adding Resource(s)\n  deluxe@flex_host\n   Cluster - fluid\t70\n   Cluster - pdf\t70\n Settings\n  Name           = deluxe\n  Server         = flex_host\n  Description    = deluxe\n  ServerType     = flexlm\n  Count          = 150\n  Flags          = Absolute\n  Type           = Unknown\n\n$ sacctmgr show resource withclusters\n      Name     Server     Type  Count LastConsumed Allocated ServerType    Cluster  Allowed                Flags \n---------- ---------- -------- ------ ------------ --------- ---------- ---------- -------- -------------------- \n    deluxe  flex_host  License    150            0       140     flexlm      fluid       70             Absolute \n    deluxe  flex_host  License    150            0       140     flexlm        pdf       70             Absolute\n\n$ sacctmgr -i update resource deluxe set allowed=25 where cluster=fluid\n Modified server resource ...\n  Cluster - fluid\t- deluxe@flex_host\n\n$ sacctmgr show resource withclusters\n      Name     Server     Type  Count LastConsumed Allocated ServerType    Cluster  Allowed                Flags \n---------- ---------- -------- ------ ------------ --------- ---------- ---------- -------- -------------------- \n    deluxe  flex_host  License    150            0        95     flexlm      fluid       25             Absolute \n    deluxe  flex_host  License    150            0        95     flexlm        pdf       70             Absolute \nThis can also be established as the default for all newly created licenses\nby adding AllResourcesAbsolute=yes to slurmdbd.conf (and restarting\nSlurmDBD to make the change take effect).Dynamic licenses\n\nStarting with Slurm 23.02, the LastConsumed field for remote licenses\nis designed to be periodically updated with the active use count from a license\nserver. An example script for FlexLM's lmstat command is provided below \u2014\nsimilar scripts can be easily constructed for other license management\nstacks.\n#!/bin/bash\n\nset -euxo pipefail\n\nLMSTAT=/opt/foobar/bin/lmstat\nLICENSE=foobar\n\nconsumed=$(${LMSTAT} | grep \"Users of ${LICENSE}\"|sed \"s/.*Total of \\([0-9]\\+\\) licenses in use)/\\1/\")\n\nsacctmgr -i update resource ${LICENSE} set lastconsumed=${consumed}\nWhen the LastConsumed value is changed through sacctmgr an update is\nautomatically pushed to the Slurm controllers. They will use this value\nto calculate a LastDeficit value \u2014 this value indicates how many\nlicenses that have \"gone missing\" from the cluster's perspective and will\nneed to be set aside temporarily.E.g., on this cluster 100 \"foobar\" licenses are available, and we are\nallocating access to 80 of them on the \"blackhole\" cluster:\n$ sacctmgr add resource foobar count=100 flags=absolute cluster=blackhole allowed=80\n Adding Resource(s)\n  foobar@slurmdb\n   Cluster - blackhole\t80\n Settings\n  Name           = foobar\n  Server         = slurmdb\n  Description    = foobar\n  Count          = 100\n  Flags          = Absolute\n  Type           = Unknown\nWould you like to commit changes? (You have 30 seconds to decide)\n(N/y): y\n$ scontrol show license\nLicenseName=foobar@slurmdb\n    Total=80 Used=0 Free=80 Reserved=0 Remote=yes\n    LastConsumed=0 LastDeficit=0 LastUpdate=2023-02-28T16:36:55\nNow, our cron job comes in and updates the LastConsumed value to 30, while\nthe cluster has yet to allocate any licenses to jobs:\n$ sacctmgr -i update resource foobar set lastconsumed=30\n Modified server resource ...\n  foobar@slurmdb\n  Cluster - blackhole\t- foobar@slurmdb\n$ scontrol show license\nLicenseName=foobar@slurmdb\n    Total=80 Used=0 Free=70 Reserved=0 Remote=yes\n    LastConsumed=30 LastDeficit=10 LastUpdate=2023-02-28T16:39:27\nNote that the cluster has now calculated a deficit of 10 licenses, and\nhas noticed that it should only schedule up to 70 licenses at the moment.\nThe cluster knows that up to 20 licenses are reserved for other clusters or\nexternal use at the moment. However, since LastConsumed was set to 30 this\nimplies an additional 10 licenses have \"gone rogue\" and their usage cannot\nbe accounted for. Thus the cluster must not assign those to any pending jobs,\nas it's likely that the job would fail to acquire the desired licenses.If a further update (likely driven through cron) now reduces the\nLastConsumed count to 10, the deficit is now considered to have disappeared,\nand the cluster will make all 80 assigned licenses available again:\n$ sacctmgr -i update resource foobar set lastconsumed=20\n Modified server resource ...\n  foobar@slurmdb\n  Cluster - blackhole\t- foobar@slurmdb\n$ scontrol show license\nLicenseName=foobar@slurmdb\n    Total=80 Used=0 Free=80 Reserved=0 Remote=yes\n    LastConsumed=20 LastDeficit=0 LastUpdate=2023-02-28T16:44:26\nLast modified 25 April 2024"
        },
        {
            "title": "Navigation",
            "content": "\nSlurm Workload Manager\nVersion 24.05\n\n\nAbout\n\nOverview\nRelease Notes\n\n\n\nUsing\n\nDocumentation\nFAQ\nPublications\n\n\n\nInstalling\n\nDownload\nRelated Software\nInstallation Guide\n\n\n\nGetting Help\n\nMailing Lists\nSupport and Training\nTroubleshooting\n\n\n"
        }
    ]
}